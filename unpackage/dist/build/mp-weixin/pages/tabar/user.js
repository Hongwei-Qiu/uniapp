(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabar/user"],{"28af":function(e,t,n){"use strict";(function(e){n("1995"),n("921b");a(n("66fd"));var t=a(n("cd99"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},3741:function(e,t,n){"use strict";n.r(t);var a=n("93c1"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},"63c4":function(e,t,n){"use strict";var a={"uni-icons":function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-icons/uni-icons")]).then(n.bind(null,"4ac6"))},"my-tabar":function(){return n.e("components/tabar/index").then(n.bind(null,"abb6"))}},o=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}))},"8c1c":function(e,t,n){"use strict";var a=n("bba1"),o=n.n(a);o.a},"93c1":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n("4b89")),o=i(n("d07b"));function i(e){return e&&e.__esModule?e:{default:e}}var c=getApp().globalData,s=c.appid,r=c.appsecret,u=c.imgRemote,d=(c.navBar,function(){Promise.all([n.e("common/vendor"),n.e("components/uni-icons/uni-icons")]).then(function(){return resolve(n("4ac6"))}.bind(null,n)).catch(n.oe)}),l={components:{uniIcons:d},data:function(){return{hShare:!1,userList:[{icon:"icon-08_zizhanghaoguanli",name:"账号管理",color:"#3DABFF",url:"accountmange"},{icon:"icon-fapiao",name:"开具发票",color:"#FF9C00",url:"receipt"},{icon:"icon-tianchongxing--",name:"账单记录",color:"#FFF000",url:"bill"},{color:"#ffab9a",icon:"icon-buy-fill",name:"购买记录",url:"purchase_record"},{icon:"icon-qianbao",name:"充值",color:"#2DC4B4",url:"invest"},{icon:"icon-juan",name:"现金劵",color:"#F8632F",url:"cash"},{icon:"icon-weixin",name:0==e.getStorageSync("is_miniBind")?"绑定微信":"改绑微信",color:"#26DD5B",url:"bindWeChat"}],count:0,is_bind:"",is_child:"",token:"",imgRemote:u,memberInfoData:"",member_default:"",code:"",shareInfo:[]}},methods:{share:function(){if(this.token)if(0==this.hShare){var t=this;t.hShare=!0;var n=Math.round((new Date).getTime()/1e3),i={appid:s,timeStamp:n},c=a.default.hexMD5(o.default.objKeySort(i)+r),u={appid:s,timeStamp:n,sign:c};o.default.getRequests("shareConfig",u,(function(e){if(200==e.data.code){var n=e.data.data;WeixinJSBridge.on("menu:share:appmessage",(function(e){WeixinJSBridge.invoke("sendAppMessage",{appid:t.userinfo.appId,img_url:n.share_img,img_width:"120",img_height:"120",link:n.share_href,desc:n.share_describe,title:n.share_title},(function(e){this.hShare=!1,console.log(e)}))}))}else o.default.Toast(e.data.msg)}))}else this.hShare=!1;else e.navigateTo({url:"/pages/account/login"})},memberInfo:function(){var e=this,t=Math.round((new Date).getTime()/1e3),n={appid:s,timeStamp:t},i=a.default.hexMD5(o.default.objKeySort(n)+r),c={appid:s,timeStamp:t,sign:i};o.default.getRequests("memberInfo",c,(function(t){200==t.data.code&&(e.memberInfoData=t.data.data.info,e.member_default=t.data.data.member_default)}))},myinfoPage:function(){var t=this;this.count++,1==this.count&&(setTimeout((function(){t.count=0}),500),this.token?e.navigateTo({url:"/pages/user/myinfo"}):e.navigateTo({url:"/pages/account/login"}))},pageUrl:function(t){var n=this;this.count++,1==this.count&&(setTimeout((function(){n.count=0}),500),this.token?"bindWeChat"==t.url?this.wxbindWeChat():(getApp().globalData.isReload=!0,e.navigateTo({url:"/pages/user/".concat(t.url)})):e.reLaunch({url:"/pages/account/login"}))},wxbindWeChat:function(t){console.log("小程序绑定");var n=this;e.showModal({content:1==this.is_bind?"是否微信改绑":"是否绑定微信",cancelText:"我再想想",cancelColor:"#999",confirmText:"确认",confirmColor:"#009a44",success:function(t){t.confirm?e.getUserInfo({provider:"weixin",success:function(t){t.encryptedData,t.iv;console.log(t),e.login({provider:"weixin",success:function(e){console.log(e.code),n.wxbindWeChata(e.code)}})}}):t.cancel}})},wxbindWeChata:function(t){var n=Math.round((new Date).getTime()/1e3),i={appid:s,code:t,timeStamp:n},c=a.default.hexMD5(o.default.objKeySort(i)+r),u={appid:s,code:t,type:"mini",timeStamp:n,sign:c};o.default.postRequests("bindWeChat",u,(function(t){200==t.data.code?(o.default.Toast("绑定微信成功"),setTimeout((function(){e.clearStorage({success:function(t){e.navigateTo({url:"/pages/account/login"})}})}),1e3)):o.default.Toast(t.data.msg)}))},adminisus_weixin:function(){console.log("H5绑定");var t=this;e.showModal({content:1==this.is_bind?"是否微信改绑":"是否绑定微信",cancelText:"我再想想",cancelColor:"#999",confirmText:"确认",confirmColor:"#DEC17C",success:function(n){if(n.confirm){e.setStorageSync("isWeixin",!0);var a=location.search,o=a.substring(a.indexOf("=")+1,a.lastIndexOf("&"));if(!o){var i=window.location.href,c=encodeURIComponent(i),s="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t.userinfo.appId+"&redirect_uri="+c+"&response_type=code&scope=snsapi_userinfo#wechat_redirect";window.location.href=s}}else n.cancel}})},alipayBind:function(t){console.log("小程序绑定");var n=this;e.showModal({content:1==this.is_bind?"是否改绑支付宝":"是否绑定支付宝",cancelText:"我再想想",cancelColor:"#999",confirmText:"确认",confirmColor:"#009a44",success:function(t){t.confirm?e.getUserInfo({provider:"alipay",success:function(t){console.log(t),e.login({provider:"alipay",success:function(e){console.log(e.code),n.alipayBinda(e.code,t.avatar)}})}}):t.cancel}})},alipayBinda:function(t,n){var i=Math.round((new Date).getTime()/1e3),c={appid:s,code:t,timeStamp:i,headimgurl:n},u=a.default.hexMD5(o.default.objKeySort(c)+r),d=Object.assign({loginType:"alipay",type:"mini",sign:u},c);o.default.postRequests("bindWeChat",d,(function(t){200==t.data.code?(o.default.Toast("绑定支付宝成功"),setTimeout((function(){e.clearStorage({success:function(t){e.navigateTo({url:"/pages/account/login"})}})}),1e3)):o.default.Toast(t.data.msg)}))},bindWeChat:function(){console.log("APP绑定");var t=this;e.getProvider({service:"oauth",success:function(n){~n.provider.indexOf("weixin")?e.login({provider:"weixin",success:function(n){e.getUserInfo({provider:"weixin",success:function(e){t.code=e.userInfo.openId,t.bindWeChata()}})}}):e.showToast({title:"手机上还没安装微信,请安装微信后重试",duration:2e3,icon:"none"})}})},bindWeChata:function(){var t=this;e.showModal({content:1==this.is_bind?"是否微信改绑":"是否绑定微信",cancelText:"我再想想",cancelColor:"#999",confirmText:"确认",confirmColor:"#DEC17C",success:function(n){if(n.confirm){var i=t.code,c=Math.round((new Date).getTime()/1e3),u={appid:s,timeStamp:c},d=a.default.hexMD5(o.default.objKeySort(u)+r),l={appid:s,app_openid:i,type:"app",timeStamp:c,sign:d};o.default.postRequests("saveMemberInfo",l,(function(t){200==t.data.code?(o.default.Toast("绑定微信成功"),setTimeout((function(){e.clearStorage({success:function(t){e.navigateTo({url:"/pages/account/login"})}})}),1e3)):o.default.Toast(t.data.msg)}))}else n.cancel}})},threePage:function(t){var n=this;if(this.count++,1==this.count)if(setTimeout((function(){n.count=0}),500),this.token)switch(t){case"recomend":e.navigateTo({url:"/pages/index/recommed"});break;case"address":e.navigateTo({url:"/pages/user/userAddress"});break;case"password":e.navigateTo({url:"/pages/user/modifypwd"});break}else e.reLaunch({url:"/pages/account/login"})},exit:function(){this.token?e.showModal({title:"提示",content:"是否退出登录？",success:function(t){if(t.confirm){var n=Math.round((new Date).getTime()/1e3),i={appid:s,timeStamp:n},c=a.default.hexMD5(o.default.objKeySort(i)+r),u={appid:s,timeStamp:n,sign:c};o.default.getRequests("logout",u,(function(t){200==t.data.code&&(o.default.Toast("退出成功"),setTimeout((function(){e.clearStorage({success:function(t){e.navigateTo({url:"/pages/account/login"})}})}),1e3))}))}else t.cancel}}):e.navigateTo({url:"/pages/account/login"})},wxConfig:function(){var e=this;if(this.token){var t=Math.round((new Date).getTime()/1e3),n={appid:s,timeStamp:t},i=a.default.hexMD5(o.default.objKeySort(n)+r),c={appid:s,timeStamp:t,sign:i};o.default.getRequests("wxConfig",c,(function(t){200==t.data.code&&(e.userinfo=t.data.data,wx.config({debug:!1,appId:t.data.data.appId,timestamp:t.data.data.timestamp,nonceStr:t.data.data.nonceStr,signature:t.data.data.signature,jsApiList:["updateAppMessageShareData","onMenuShareAppMessage"]}))}))}}},onLoad:function(){e.hideTabBar()},onShow:function(){var t=this;t.memberInfo(),t.is_bind=e.getStorageSync("is_miniBind"),t.is_child=e.getStorageSync("is_child"),t.token=e.getStorageSync("cdj_token");var n=Math.round((new Date).getTime()/1e3),i={appid:s,timeStamp:n},c=a.default.hexMD5(o.default.objKeySort(i)+r),u={appid:s,timeStamp:n,sign:c};o.default.getRequests("shareConfig",u,(function(e){200==e.data.code&&(t.shareInfo=e.data.data)}))},onShareAppMessage:function(){var e=this.shareInfo.share_href;return{imageUrl:this.shareInfo.share_img,path:e.substring(e.indexOf("#")+1),desc:this.shareInfo.share_describe,title:this.shareInfo.share_title}}};t.default=l}).call(this,n("543d")["default"])},bba1:function(e,t,n){},cd99:function(e,t,n){"use strict";n.r(t);var a=n("63c4"),o=n("3741");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("8c1c");var c,s=n("f0c5"),r=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],c);t["default"]=r.exports}},[["28af","common/runtime","common/vendor"]]]);